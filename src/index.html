
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>PayChain Payroll</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.2/dist/ethers.min.js"></script>
    <style>
      body {
        background-color: #1f1f1f;
        color: white;
      }
    </style>
  </head>
  <body class="font-sans px-4 sm:px-6 lg:px-8 py-10">
    <div class="max-w-xl mx-auto text-center">
      <!-- Text-based Logo -->
      <div class="text-5xl font-extrabold text-yellow-400 mb-4">Pc</div>
      <h1 class="text-4xl font-bold text-yellow-400 mb-2">PayChain Payroll</h1>
      <p class="text-gray-300 text-md mb-6">
        Smart payroll system on blockchain ‚Äî send & receive PTT with full control.
      </p>
      <button onclick="connectWallet()" id="connectBtn" class="bg-yellow-500 text-black font-bold py-2 px-4 rounded-xl hover:bg-yellow-600 transition">
        Connect Wallet
      </button>
    </div>

    <!-- Action Card -->
    <div class="max-w-xl mx-auto mt-10 bg-gray-900 rounded-2xl shadow-2xl p-6 space-y-4">
      <h2 class="text-2xl font-semibold text-yellow-400">Send Pharos</h2>
      <input type="text" id="recipient" placeholder="Recipient Address" class="w-full p-3 rounded-lg bg-gray-800 text-white placeholder-gray-500 outline-none focus:ring-2 focus:ring-yellow-500" />
      <input type="number" id="amount" placeholder="Amount (PTT)" class="w-full p-3 rounded-lg bg-gray-800 text-white placeholder-gray-500 outline-none focus:ring-2 focus:ring-yellow-500" />
      <button onclick="sendETH()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 rounded-xl transition duration-300">
        ‚û§ Send
      </button>
    </div>

    <!-- Balance -->
    <div class="max-w-xl mx-auto mt-8 bg-gray-900 rounded-2xl shadow-xl p-4">
      <h2 class="text-xl font-semibold text-yellow-400">Wallet Balance</h2>
      <p id="balance" class="mt-1 text-white">0.00 ETH</p>
    </div>

    <!-- Withdraw (for Owner only) -->
    <div class="max-w-xl mx-auto mt-4 bg-gray-900 rounded-2xl shadow-xl p-4">
      <h2 class="text-xl font-semibold text-yellow-400">Withdraw</h2>
      <button onclick="withdraw()" class="mt-2 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-xl">
        üîí Owner Withdraw
      </button>
    </div>

    <!-- Transaction History -->
    <div class="max-w-xl mx-auto mt-6 bg-gray-900 rounded-2xl shadow-xl p-4">
      <h2 class="text-xl font-semibold text-yellow-400">Transaction History</h2>
      <ul id="txHistory" class="list-disc list-inside text-sm text-gray-300 mt-2"></ul>
    </div>

    <!-- Footer -->
    <p class="mt-10 text-center text-gray-500 text-sm">
      ¬© 2025 PayChain. Built with Web3 ‚ù§Ô∏è
    </p>

    <!-- Script -->
    <script>
      const provider = new ethers.BrowserProvider(window.ethereum);
      let signer, userAddress;

      async function connectWallet() {
        try {
          const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
          signer = await provider.getSigner();
          userAddress = accounts[0];
          document.getElementById('connectBtn').innerText = 'Connected: ' + userAddress.slice(0, 6) + '...' + userAddress.slice(-4);
          updateBalance();
          listenForEvents();
        } catch (err) {
          alert('Wallet connection failed!');
          console.error(err);
        }
      }

      const contractAddress = "0x7f37fb1882A33593A842748A71781Bf4Cea169DD";
      const abi = [
        "function sendEth(address recipient) payable",
        "function withdraw()",
        "event PaymentSent(address indexed from, address indexed to, uint amount)"
      ];

      const contract = new ethers.Contract(contractAddress, abi, provider);

      async function sendETH() {
        const recipient = document.getElementById("recipient").value;
        const amount = document.getElementById("amount").value;
        if (!recipient || !amount) return alert("Fill both fields!");

        const tx = await contract.connect(signer).sendEth(recipient, { value: ethers.parseEther(amount) });
        await tx.wait();
        alert("‚úÖ ETH Sent!");
        updateBalance();
      }

      async function updateBalance() {
        if (!signer) return;
        const balance = await provider.getBalance(userAddress);
        document.getElementById("balance").innerText = ethers.formatEther(balance) + " ETH";
      }

      async function withdraw() {
        try {
          const tx = await contract.connect(signer).withdraw();
          await tx.wait();
          alert("‚úÖ Withdraw successful!");
          updateBalance();
        } catch (err) {
          alert("‚ùå Only owner can withdraw.");
          console.error(err);
        }
      }

      function listenForEvents() {
        contract.on("PaymentSent", (from, to, amount) => {
          const li = document.createElement("li");
          li.innerText = `üí∏ ${from.slice(0, 6)}... ‚Üí ${to.slice(0, 6)}... : ${ethers.formatEther(amount)} ETH`;
          document.getElementById("txHistory").prepend(li);
        });
      }
    </script>
  </body>
</html>